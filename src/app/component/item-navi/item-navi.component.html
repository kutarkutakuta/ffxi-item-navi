<div nz-row>
  <div nz-col>
    <nz-select [(ngModel)]="selectedJobs" nzSize="default" nzMode="multiple"
      nzPlaceHolder="ジョブ" nzAllowClear="true" maxlength="100"
      style="width: 150px" (ngModelChange)="inputChange()">
      <nz-option *ngFor="let option of jobs" [nzLabel]="option" [nzValue]="option"></nz-option>
    </nz-select>
  </div>
  <div nz-col>
    <nz-select [(ngModel)]="selectedWepons" nzSize="default" nzMode="multiple"
      nzPlaceHolder="武器" nzAllowClear="true" maxlength="100"
      style="width: 240px" (ngModelChange)="inputChange()">
      <nz-option *ngFor="let option of wepons" [nzLabel]="option" [nzValue]="option"></nz-option>
    </nz-select>
    <nz-select [(ngModel)]="selectedArmors" nzSize="default"
      nzMode="multiple" nzPlaceHolder="防具" nzAllowClear="true" maxlength="100"
      style="width: 240px" (ngModelChange)="inputChange()">
      <nz-option *ngFor="let option of armors" [nzLabel]="option" [nzValue]="option"></nz-option>
    </nz-select>
  </div>
</div>
<div nz-row>
  <nz-input-group [nzPrefix]="prefixIconSearch" [nzSuffix]="suffixIconSearch" style="max-width:630px">
    <input type="text" nz-input placeholder="(例) 被ダメージ<-2 PET:攻>20" maxlength="200"
      [(ngModel)]="inputValue" nzAllowClear="true" (change)="inputChange()" />
  </nz-input-group>
  <ng-template #prefixIconSearch>
    <a style="color: rgba(0,0,0,0.85)" (click)="showIQueryBuilder()">
      <span nz-icon nzType="form" nzTheme="outline"></span>
    </a>
  </ng-template>
  <ng-template #suffixIconSearch>
    <span nz-icon class="ant-input-clear-icon" nzTheme="fill"
      nzType="close-circle" *ngIf="inputValue" (click)="inputValue = ''; inputChange()"></span>
    <span nz-icon nzType="search" *ngIf="!inputValue"></span>
  </ng-template>
</div>

<div style="height: 100%;">
  <nz-table #basicTable [nzData]="equipments" [nzLoading]="loading" [nzShowPagination]="false" [nzPageSize]="100"
    nzSize="small" nzBordered="true" [nzScroll]="{x: '100%', y: 'calc(100vh - 150px)'}">
    <thead>
      <tr>
        <th nzWidth="175px">NAME</th>
        <ng-container *ngFor="let key of opKeywords">
          <th nzWidth="48px" style="text-overflow: ellipsis;white-space: nowrap;">
            <span [nzTooltipTitle]="key" nzTooltipPlacement="topLeft" nz-tooltip>
              {{ getShrotStatusName(key) }}
            </span>
          </th>
        </ng-container>
        <th nzWidth="350px">PC</th>
        <th nzWidth="150px">PET</th>
        <th nzWidth="250px">OTHER</th>
      </tr>
    </thead>
    <tbody>
      <ng-template nz-virtual-scroll let-data let-index="index">
        <tr>
          <td [nzShowExpand]="data.show_expand" (nzExpandChange)="expandChange(data.id, $event);" [nzExpand]="data.expanded">
            <a aria-label="Name1" (click)="showItemDetail(data)" style="font-size: larger;font-weight: bolder;">
              <span [innerHTML]="replacer(data.name,'NAME')"></span>
            </a>
            <div style="padding-left: 10px;">
              {{ data.slot }} {{ data.item_lv ? "＜IL:" + data.item_lv + "＞" : "" }}
              <br />
              Lv{{ data.lv }} {{ data.job }}
            </div>
          </td>
          <ng-container *ngFor="let keyword of opKeywords">
            <td class="status_value">{{ getStatusValue(data, keyword) }}</td>
          </ng-container>
          <td><div [innerHTML]="replacer(data.pc_text,'PC')"></div></td>
          <td>
            <div *ngIf="data.pet_status_target">
              {{data.pet_status_target != 'ペット' ? '(' + data.pet_status_target + ') ' : ''}}
              <div  [innerHTML]="replacer(data.pet_text,'PET')"></div>
            </div>
          </td>
          <td>
            <div [innerHTML]="replacer(data.other_text,'OTHER')"></div>
          </td>
        </tr>
        <ng-container  *ngFor="let aug of data.equipment_augs">
          <tr *ngIf="data.expanded">
            <td [nzIndentSize]="5">
              {{aug.aug_type}}{{aug.aug_rank ? ' Rank:' + aug.aug_rank : ''}}
            </td>
            <ng-container *ngFor="let keyword of opKeywords">
              <td class="status_value">{{ getStatusValue(aug, keyword) }}</td>
            </ng-container>
            <td><div [innerHTML]="replacer(aug.pc_text,'PC')"></div></td>
            <td>
              <div *ngIf="aug.pet_status_target">
                {{aug.pet_status_target != 'ペット' ? '(' + aug.pet_status_target + ') ' : ''}}
                <div  [innerHTML]="replacer(aug.pet_text,'PET')"></div>
              </div>
            </td>
            <td>
              <div [innerHTML]="replacer(aug.other_text,'OTHER')"></div>
            </td>
          </tr>
        </ng-container>
      </ng-template>

    </tbody>
  </nz-table>
</div>
<app-item-detail #ItemDetail></app-item-detail>
<app-query-builder #QueryBuilder (created)="addQuery($event)"></app-query-builder>
